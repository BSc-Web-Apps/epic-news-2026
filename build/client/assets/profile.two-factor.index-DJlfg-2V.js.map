{"version":3,"file":"profile.two-factor.index-DJlfg-2V.js","sources":["../../../app/routes/settings+/profile.two-factor.index.tsx"],"sourcesContent":["import { type SEOHandle } from '@nasa-gcn/remix-seo'\nimport { redirect, Link, useFetcher } from 'react-router'\nimport { Icon } from '#app/components/ui/icon.tsx'\nimport { StatusButton } from '#app/components/ui/status-button.tsx'\nimport { requireUserId } from '#app/utils/auth.server.ts'\nimport { prisma } from '#app/utils/db.server.ts'\nimport { generateTOTP } from '#app/utils/totp.server.ts'\nimport { type Route } from './+types/profile.two-factor.index.ts'\nimport { twoFAVerificationType } from './profile.two-factor.tsx'\nimport { twoFAVerifyVerificationType } from './profile.two-factor.verify.tsx'\n\nexport const handle: SEOHandle = {\n\tgetSitemapEntries: () => null,\n}\n\nexport async function loader({ request }: Route.LoaderArgs) {\n\tconst userId = await requireUserId(request)\n\tconst verification = await prisma.verification.findUnique({\n\t\twhere: { target_type: { type: twoFAVerificationType, target: userId } },\n\t\tselect: { id: true },\n\t})\n\treturn { is2FAEnabled: Boolean(verification) }\n}\n\nexport async function action({ request }: Route.ActionArgs) {\n\tconst userId = await requireUserId(request)\n\tconst { otp: _otp, ...config } = await generateTOTP()\n\tconst verificationData = {\n\t\t...config,\n\t\ttype: twoFAVerifyVerificationType,\n\t\ttarget: userId,\n\t}\n\tawait prisma.verification.upsert({\n\t\twhere: {\n\t\t\ttarget_type: { target: userId, type: twoFAVerifyVerificationType },\n\t\t},\n\t\tcreate: verificationData,\n\t\tupdate: verificationData,\n\t})\n\treturn redirect('/settings/profile/two-factor/verify')\n}\n\nexport default function TwoFactorRoute({ loaderData }: Route.ComponentProps) {\n\tconst enable2FAFetcher = useFetcher<typeof action>()\n\n\treturn (\n\t\t<div className=\"flex flex-col gap-4\">\n\t\t\t{loaderData.is2FAEnabled ? (\n\t\t\t\t<>\n\t\t\t\t\t<p className=\"text-lg\">\n\t\t\t\t\t\t<Icon name=\"check\">\n\t\t\t\t\t\t\tYou have enabled two-factor authentication.\n\t\t\t\t\t\t</Icon>\n\t\t\t\t\t</p>\n\t\t\t\t\t<Link to=\"disable\">\n\t\t\t\t\t\t<Icon name=\"lock-open-1\">Disable 2FA</Icon>\n\t\t\t\t\t</Link>\n\t\t\t\t</>\n\t\t\t) : (\n\t\t\t\t<>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<Icon name=\"lock-open-1\">\n\t\t\t\t\t\t\tYou have not enabled two-factor authentication yet.\n\t\t\t\t\t\t</Icon>\n\t\t\t\t\t</p>\n\t\t\t\t\t<p className=\"text-sm\">\n\t\t\t\t\t\tTwo factor authentication adds an extra layer of security to your\n\t\t\t\t\t\taccount. You will need to enter a code from an authenticator app\n\t\t\t\t\t\tlike{' '}\n\t\t\t\t\t\t<a className=\"underline\" href=\"https://1password.com/\">\n\t\t\t\t\t\t\t1Password\n\t\t\t\t\t\t</a>{' '}\n\t\t\t\t\t\tto log in.\n\t\t\t\t\t</p>\n\t\t\t\t\t<enable2FAFetcher.Form method=\"POST\">\n\t\t\t\t\t\t<StatusButton\n\t\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\t\tname=\"intent\"\n\t\t\t\t\t\t\tvalue=\"enable\"\n\t\t\t\t\t\t\tstatus={enable2FAFetcher.state === 'loading' ? 'pending' : 'idle'}\n\t\t\t\t\t\t\tclassName=\"mx-auto\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tEnable 2FA\n\t\t\t\t\t\t</StatusButton>\n\t\t\t\t\t</enable2FAFetcher.Form>\n\t\t\t\t</>\n\t\t\t)}\n\t\t</div>\n\t)\n}\n"],"names":["handle","getSitemapEntries","profile_twoFactor_index","_UNSAFE_withComponentProps","loaderData","enable2FAFetcher","useFetcher","className","children","is2FAEnabled","jsxs","Fragment","jsx","Icon","name","Link","to","href","Form","method","StatusButton","type","value","status","state"],"mappings":"uUAWO,MAAMA,EAAoB,CAChCC,kBAAmBA,IAAM,IAC1B,EA6BAC,EAAAC,EAAA,SAAuC,CAAEC,WAAAA,CAAW,EAAyB,CAC5E,MAAMC,EAAmBC,EAAA,EAEzB,aACE,MAAA,CAAIC,UAAU,sBACbC,SAAAJ,EAAWK,aACXC,EAAAA,KAAAC,EAAAA,SAAA,CACCH,SAAA,CAAAI,EAAAA,IAAC,IAAA,CAAEL,UAAU,UACZC,SAAAI,EAAAA,IAACC,GAAKC,KAAK,QAAQN,uDAEnB,CAAA,CACD,EACAI,EAAAA,IAACG,GAAKC,GAAG,UACRR,eAACK,EAAA,CAAKC,KAAK,cAAcN,SAAA,cAAW,CAAA,CACrC,CAAA,CAAA,CACD,EAEAE,EAAAA,KAAAC,WAAA,CACCH,SAAA,CAAAI,EAAAA,IAAC,KACAJ,SAAAI,EAAAA,IAACC,EAAA,CAAKC,KAAK,cAAcN,+DAEzB,CAAA,CACD,EACAE,EAAAA,KAAC,IAAA,CAAEH,UAAU,UAAUC,SAAA,CAAA,0IAGjB,UACJ,IAAA,CAAED,UAAU,YAAYU,KAAK,yBAAyBT,SAAA,WAAA,CAEvD,EAAK,IAAI,YAAA,EAEV,EACAI,EAAAA,IAACP,EAAiBa,KAAjB,CAAsBC,OAAO,OAC7BX,SAAAI,EAAAA,IAACQ,EAAA,CACAC,KAAK,SACLP,KAAK,SACLQ,MAAM,SACNC,OAAQlB,EAAiBmB,QAAU,UAAY,UAAY,OAC3DjB,UAAU,UACVC,SAAA,aAED,CAAA,CACD,CAAA,EACD,CAAA,CAEF,CAEF,CAAA"}