import{j as e,F as N,r as n}from"./chunk-UH6JLGW7-vC5r3Eub.js";import{b as T,d as I,c as F,I as P}from"./misc-CB38qpgG.js";import{f as w}from"./floating-toolbar-VQB8DV6X.js";import{F as L,T as E,E as u,a as S}from"./forms-D7XpjJLD.js";import{B as f}from"./button-BP3wkmPp.js";import{I as g}from"./icon-C3K2m46L.js";import{L as b}from"./dom--0h4o3Zv.js";import{S as z}from"./status-button-hfmu5Em_.js";import{u as B,F as k,g as R,a as h,b as v,c as A}from"./helpers-Ch5Ym2hM.js";import{g as C}from"./constraint-cuuFo8uo.js";import{p as M}from"./parse-Bbiqquwr.js";import{o as y,s as d,i as V,b as O}from"./types-kDhgxygl.js";const Z=1,D=100,U=1,W=1e4,_=1024*1024*3,K=y({id:d().optional(),file:V(File).optional().refine(t=>!t||t.size<=_,"File size must be less than 3MB"),altText:d().optional()}),j=y({id:d().optional(),title:d().min(Z).max(D),content:d().min(U).max(W),images:O(K).max(5).optional()});function ie({note:t,actionData:c}){const s=T(),[r,a]=B({id:"note-editor",constraint:C(j),lastResult:c?.result,onValidate({formData:i}){return M(i,{schema:j})},defaultValue:{...t,images:t?.images??[{}]},shouldRevalidate:"onBlur"}),m=a.images.getFieldList();return e.jsx("div",{className:"absolute inset-0",children:e.jsxs(k,{context:r.context,children:[e.jsxs(N,{method:"POST",className:"flex h-full flex-col gap-y-4 overflow-x-hidden overflow-y-auto px-10 pt-12 pb-28",...R(r),encType:"multipart/form-data",children:[e.jsx("button",{type:"submit",className:"hidden"}),t?e.jsx("input",{type:"hidden",name:"id",value:t.id}):null,e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(L,{labelProps:{children:"Title"},inputProps:{autoFocus:!0,...h(a.title,{type:"text"})},errors:a.title.errors}),e.jsx(E,{labelProps:{children:"Content"},textareaProps:{...v(a.content)},errors:a.content.errors}),e.jsxs("div",{children:[e.jsx(b,{children:"Images"}),e.jsx("ul",{className:"flex flex-col gap-4",children:m.map((i,x)=>{const o=i.getFieldset().id.value,p=t?.images.find(({id:l})=>l===o);return e.jsxs("li",{className:"border-muted-foreground relative border-b-2",children:[e.jsxs("button",{className:"text-foreground-destructive absolute top-0 right-0",...r.remove.getButtonProps({name:a.images.name,index:x}),children:[e.jsx("span",{"aria-hidden":!0,children:e.jsx(g,{name:"cross-1"})})," ",e.jsxs("span",{className:"sr-only",children:["Remove image ",x+1]})]}),e.jsx(X,{meta:i,objectKey:p?.objectKey})]},i.key)})})]}),e.jsxs(f,{className:"mt-3",...r.insert.getButtonProps({name:a.images.name}),children:[e.jsx("span",{"aria-hidden":!0,children:e.jsx(g,{name:"plus",children:"Image"})})," ",e.jsx("span",{className:"sr-only",children:"Add image"})]})]}),e.jsx(u,{id:r.errorId,errors:r.errors})]}),e.jsxs("div",{className:w,children:[e.jsx(f,{variant:"destructive",...r.reset.getButtonProps(),children:"Reset"}),e.jsx(z,{form:r.id,type:"submit",disabled:s,status:s?"pending":"idle",children:"Submit"})]})]})})}function X({meta:t,objectKey:c}){const s=t.getFieldset(),r=!!s.id.initialValue,[a,m]=n.useState(c?I(c):null),[i,x]=n.useState(s.altText.initialValue??"");return e.jsxs("fieldset",{...A(t),children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"w-32",children:[e.jsx("div",{className:"relative size-32",children:e.jsxs("label",{htmlFor:s.file.id,className:F("group absolute size-32 rounded-lg",{"bg-accent opacity-40 focus-within:opacity-100 hover:opacity-100":!a,"cursor-pointer focus-within:ring-2":!r}),children:[a?e.jsxs("div",{className:"relative",children:[r&&!a.startsWith("data:")?e.jsx(P,{src:a,alt:i??"",className:"size-32 rounded-lg object-cover",width:512,height:512}):e.jsx("img",{src:a,alt:i??"",className:"size-32 rounded-lg object-cover"}),r?null:e.jsx("div",{className:"bg-secondary text-secondary-foreground pointer-events-none absolute -top-0.5 -right-0.5 rotate-12 rounded-sm px-2 py-1 text-xs shadow-md",children:"new"})]}):e.jsx("div",{className:"border-muted-foreground text-muted-foreground flex size-32 items-center justify-center rounded-lg border text-4xl",children:e.jsx(g,{name:"plus"})}),r?n.createElement("input",{...h(s.id,{type:"hidden"}),key:s.id.key}):null,n.createElement("input",{"aria-label":"Image",className:"absolute top-0 left-0 z-0 size-32 cursor-pointer opacity-0",onChange:o=>{const p=o.target.files?.[0];if(p){const l=new FileReader;l.onloadend=()=>{m(l.result)},l.readAsDataURL(p)}else m(null)},accept:"image/*",...h(s.file,{type:"file"}),key:s.file.key})]})}),e.jsx("div",{className:"min-h-[32px] px-4 pt-1 pb-3",children:e.jsx(u,{id:s.file.errorId,errors:s.file.errors})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(b,{htmlFor:s.altText.id,children:"Alt Text"}),n.createElement(S,{onChange:o=>x(o.currentTarget.value),...v(s.altText),key:s.altText.key}),e.jsx("div",{className:"min-h-[32px] px-4 pt-1 pb-3",children:e.jsx(u,{id:s.altText.errorId,errors:s.altText.errors})})]})]}),e.jsx("div",{className:"min-h-[32px] px-4 pt-1 pb-3",children:e.jsx(u,{id:t.errorId,errors:t.errors})})]})}export{ie as N};
//# sourceMappingURL=__note-editor-i02hIIcD.js.map
