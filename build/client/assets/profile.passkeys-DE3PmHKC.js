import{j as u,w as W,Q as F,r as K,F as U}from"./chunk-UH6JLGW7-vC5r3Eub.js";import{W as h,i as L,b as V,t as Y,a as N,c as q,d as R,e as J}from"./toAuthenticatorAttachment-BAxCDoik.js";import{B as I}from"./button-BP3wkmPp.js";import{I as M}from"./icon-C3K2m46L.js";import{o as b,b as H,s as w,c as X,e as A,x as z,l as B}from"./types-kDhgxygl.js";import"./index-Bn1b60ek.js";import"./misc-CB38qpgG.js";function G({error:e,options:n}){const{publicKey:t}=n;if(!t)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(n.signal instanceof AbortSignal)return new h({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(t.authenticatorSelection?.requireResidentKey===!0)return new h({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(n.mediation==="conditional"&&t.authenticatorSelection?.userVerification==="required")return new h({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(t.authenticatorSelection?.userVerification==="required")return new h({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new h({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new h({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return t.pubKeyCredParams.filter(r=>r.type==="public-key").length===0?new h({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new h({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const a=globalThis.location.hostname;if(L(a)){if(t.rp.id!==a)return new h({message:`The RP ID "${t.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new h({message:`${globalThis.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(t.user.id.byteLength<1||t.user.id.byteLength>64)return new h({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new h({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}async function Q(e){!e.optionsJSON&&e.challenge&&(console.warn("startRegistration() was not called correctly. It will try to continue with the provided options, but this call should be refactored to use the expected call structure instead. See https://simplewebauthn.dev/docs/packages/browser#typeerror-cannot-read-properties-of-undefined-reading-challenge for more information."),e={optionsJSON:e});const{optionsJSON:n,useAutoRegister:t=!1}=e;if(!V())throw new Error("WebAuthn is not supported in this browser");const a={...n,challenge:N(n.challenge),user:{...n.user,id:N(n.user.id)},excludeCredentials:n.excludeCredentials?.map(Y)},r={};t&&(r.mediation="conditional"),r.publicKey=a,r.signal=q.createNewAbortSignal();let s;try{s=await navigator.credentials.create(r)}catch(l){throw G({error:l,options:r})}if(!s)throw new Error("Registration was not completed");const{id:o,rawId:i,response:c,type:m}=s;let g;typeof c.getTransports=="function"&&(g=c.getTransports());let p;if(typeof c.getPublicKeyAlgorithm=="function")try{p=c.getPublicKeyAlgorithm()}catch(l){x("getPublicKeyAlgorithm()",l)}let d;if(typeof c.getPublicKey=="function")try{const l=c.getPublicKey();l!==null&&(d=R(l))}catch(l){x("getPublicKey()",l)}let f;if(typeof c.getAuthenticatorData=="function")try{f=R(c.getAuthenticatorData())}catch(l){x("getAuthenticatorData()",l)}return{id:o,rawId:R(i),response:{attestationObject:R(c.attestationObject),clientDataJSON:R(c.clientDataJSON),transports:g,publicKeyAlgorithm:p,publicKey:d,authenticatorData:f},type:m,clientExtensionResults:s.getClientExtensionResults(),authenticatorAttachment:J(s.authenticatorAttachment)}}function x(e,n){console.warn(`The browser extension that intercepted this WebAuthn API call incorrectly implemented ${e}. You should report this error to them.
`,n)}const D=43200,k=1440,j=Symbol.for("constructDateFrom");function O(e,n){return typeof e=="function"?e(n):e&&typeof e=="object"&&j in e?e[j](n):e instanceof Date?new e.constructor(n):new Date(n)}function y(e,n){return O(e,e)}let $={};function Z(){return $}function C(e){const n=y(e),t=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return t.setUTCFullYear(n.getFullYear()),+e-+t}function _(e,...n){const t=O.bind(null,n.find(a=>typeof a=="object"));return n.map(t)}function S(e,n){const t=+y(e)-+y(n);return t<0?-1:t>0?1:t}function ee(e){return O(e,Date.now())}function te(e,n,t){const[a,r]=_(t?.in,e,n),s=a.getFullYear()-r.getFullYear(),o=a.getMonth()-r.getMonth();return s*12+o}function ne(e){return n=>{const t=Math.trunc,a=t(n);return a===0?0:a}}function ae(e,n){return+y(e)-+y(n)}function re(e,n){const t=y(e);return t.setHours(23,59,59,999),t}function oe(e,n){const t=y(e),a=t.getMonth();return t.setFullYear(t.getFullYear(),a+1,0),t.setHours(23,59,59,999),t}function ie(e,n){const t=y(e);return+re(t)==+oe(t)}function se(e,n,t){const[a,r,s]=_(t?.in,e,e,n),o=S(r,s),i=Math.abs(te(r,s));if(i<1)return 0;r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-o*i);let c=S(r,s)===-o;ie(a)&&i===1&&S(a,s)===1&&(c=!1);const m=o*(i-+c);return m===0?0:m}function ce(e,n,t){const a=ae(e,n)/1e3;return ne()(a)}const ue={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},le=(e,n,t)=>{let a;const r=ue[e];return typeof r=="string"?a=r:n===1?a=r.one:a=r.other.replace("{{count}}",n.toString()),t?.addSuffix?t.comparison&&t.comparison>0?"in "+a:a+" ago":a};function T(e){return(n={})=>{const t=n.width?String(n.width):e.defaultWidth;return e.formats[t]||e.formats[e.defaultWidth]}}const de={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},me={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},he={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},fe={date:T({formats:de,defaultWidth:"full"}),time:T({formats:me,defaultWidth:"full"}),dateTime:T({formats:he,defaultWidth:"full"})},pe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},ye=(e,n,t,a)=>pe[e];function v(e){return(n,t)=>{const a=t?.context?String(t.context):"standalone";let r;if(a==="formatting"&&e.formattingValues){const o=e.defaultFormattingWidth||e.defaultWidth,i=t?.width?String(t.width):o;r=e.formattingValues[i]||e.formattingValues[o]}else{const o=e.defaultWidth,i=t?.width?String(t.width):e.defaultWidth;r=e.values[i]||e.values[o]}const s=e.argumentCallback?e.argumentCallback(n):n;return r[s]}}const ge={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},be={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},we={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Re={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},ve={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Pe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},De=(e,n)=>{const t=Number(e),a=t%100;if(a>20||a<10)switch(a%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},Me={ordinalNumber:De,era:v({values:ge,defaultWidth:"wide"}),quarter:v({values:be,defaultWidth:"wide",argumentCallback:e=>e-1}),month:v({values:we,defaultWidth:"wide"}),day:v({values:Re,defaultWidth:"wide"}),dayPeriod:v({values:ve,defaultWidth:"wide",formattingValues:Pe,defaultFormattingWidth:"wide"})};function P(e){return(n,t={})=>{const a=t.width,r=a&&e.matchPatterns[a]||e.matchPatterns[e.defaultMatchWidth],s=n.match(r);if(!s)return null;const o=s[0],i=a&&e.parsePatterns[a]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(i)?Ee(i,p=>p.test(o)):Se(i,p=>p.test(o));let m;m=e.valueCallback?e.valueCallback(c):c,m=t.valueCallback?t.valueCallback(m):m;const g=n.slice(o.length);return{value:m,rest:g}}}function Se(e,n){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&n(e[t]))return t}function Ee(e,n){for(let t=0;t<e.length;t++)if(n(e[t]))return t}function Ae(e){return(n,t={})=>{const a=n.match(e.matchPattern);if(!a)return null;const r=a[0],s=n.match(e.parsePattern);if(!s)return null;let o=e.valueCallback?e.valueCallback(s[0]):s[0];o=t.valueCallback?t.valueCallback(o):o;const i=n.slice(r.length);return{value:o,rest:i}}}const xe=/^(\d+)(th|st|nd|rd)?/i,Te=/\d+/i,Oe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},_e={any:[/^b/i,/^(a|c)/i]},Ne={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Ie={any:[/1/i,/2/i,/3/i,/4/i]},ke={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},je={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Ce={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},We={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Fe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Ke={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Ue={ordinalNumber:Ae({matchPattern:xe,parsePattern:Te,valueCallback:e=>parseInt(e,10)}),era:P({matchPatterns:Oe,defaultMatchWidth:"wide",parsePatterns:_e,defaultParseWidth:"any"}),quarter:P({matchPatterns:Ne,defaultMatchWidth:"wide",parsePatterns:Ie,defaultParseWidth:"any",valueCallback:e=>e+1}),month:P({matchPatterns:ke,defaultMatchWidth:"wide",parsePatterns:je,defaultParseWidth:"any"}),day:P({matchPatterns:Ce,defaultMatchWidth:"wide",parsePatterns:We,defaultParseWidth:"any"}),dayPeriod:P({matchPatterns:Fe,defaultMatchWidth:"any",parsePatterns:Ke,defaultParseWidth:"any"})},Le={code:"en-US",formatDistance:le,formatLong:fe,formatRelative:ye,localize:Me,match:Ue,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Ve(e,n,t){const a=Z(),r=t?.locale??a.locale??Le,s=2520,o=S(e,n);if(isNaN(o))throw new RangeError("Invalid time value");const i=Object.assign({},t,{addSuffix:t?.addSuffix,comparison:o}),[c,m]=_(t?.in,...o>0?[n,e]:[e,n]),g=ce(m,c),p=(C(m)-C(c))/1e3,d=Math.round((g-p)/60);let f;if(d<2)return d===0?r.formatDistance("lessThanXMinutes",1,i):r.formatDistance("xMinutes",d,i);if(d<45)return r.formatDistance("xMinutes",d,i);if(d<90)return r.formatDistance("aboutXHours",1,i);if(d<k){const l=Math.round(d/60);return r.formatDistance("aboutXHours",l,i)}else{if(d<s)return r.formatDistance("xDays",1,i);if(d<D){const l=Math.round(d/k);return r.formatDistance("xDays",l,i)}else if(d<D*2)return f=Math.round(d/D),r.formatDistance("aboutXMonths",f,i)}if(f=se(m,c),f<12){const l=Math.round(d/D);return r.formatDistance("xMonths",l,i)}else{const l=f%12,E=Math.trunc(f/12);return l<3?r.formatDistance("aboutXYears",E,i):l<9?r.formatDistance("overXYears",E,i):r.formatDistance("almostXYears",E+1,i)}}function Ye(e,n){return Ve(e,ee(e),n)}const $e={breadcrumb:u.jsx(M,{name:"passkey",children:"Passkeys"})},qe=b({options:b({rp:b({id:w(),name:w()}),user:b({id:w(),name:w(),displayName:w()}),challenge:w(),pubKeyCredParams:H(b({type:B("public-key"),alg:z()})),authenticatorSelection:b({authenticatorAttachment:A(["platform","cross-platform"]).optional(),residentKey:A(["required","preferred","discouraged"]).optional(),userVerification:A(["required","preferred","discouraged"]).optional(),requireResidentKey:X().optional()}).optional()})}),Ze=W(function({loaderData:n}){const t=F(),[a,r]=K.useState(null);async function s(){try{r(null);const i=await(await fetch("/webauthn/registration")).json(),c=qe.parse(i),m=await Q({optionsJSON:c.options});if(!(await fetch("/webauthn/registration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)})).ok)throw new Error("Failed to verify registration");t.revalidate()}catch(o){console.error("Failed to create passkey:",o),r("Failed to create passkey. Please try again.")}}return u.jsxs("div",{className:"flex flex-col gap-6",children:[u.jsxs("div",{className:"flex justify-between gap-4",children:[u.jsx("h1",{className:"text-h1",children:"Passkeys"}),u.jsx("form",{action:s,children:u.jsx(I,{type:"submit",variant:"secondary",className:"flex items-center gap-2",children:u.jsx(M,{name:"plus",children:"Register new passkey"})})})]}),a?u.jsx("div",{className:"bg-destructive/15 text-destructive rounded-lg p-4",children:a}):null,n.passkeys.length?u.jsx("ul",{className:"flex flex-col gap-4",title:"passkeys",children:n.passkeys.map(o=>u.jsxs("li",{className:"border-muted-foreground flex items-center justify-between gap-4 rounded-lg border p-4",children:[u.jsxs("div",{className:"flex flex-col gap-2",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(M,{name:"lock-closed"}),u.jsx("span",{className:"font-semibold",children:o.deviceType==="platform"?"Device":"Security Key"})]}),u.jsxs("div",{className:"text-muted-foreground text-sm",children:["Registered ",Ye(new Date(o.createdAt))," ","ago"]})]}),u.jsxs(U,{method:"POST",children:[u.jsx("input",{type:"hidden",name:"passkeyId",value:o.id}),u.jsx(I,{type:"submit",name:"intent",value:"delete",variant:"destructive",size:"sm",className:"flex items-center gap-2",children:u.jsx(M,{name:"trash",children:"Delete"})})]})]},o.id))}):u.jsx("div",{className:"text-muted-foreground text-center",children:"No passkeys registered yet"})]})});export{Ze as default,$e as handle};
//# sourceMappingURL=profile.passkeys-DE3PmHKC.js.map
